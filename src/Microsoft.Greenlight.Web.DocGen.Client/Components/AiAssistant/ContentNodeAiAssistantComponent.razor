@using Microsoft.Greenlight.Shared.Contracts.DTO.Document
@inject IDialogService DialogService

<MudTooltip Text="Get AI assistance for this content">
    <MudIconButton Icon="@Icons.Material.Filled.SmartToy"
                   Size="Size.Small"
                   Color="Color.Secondary"
                   OnClick="OpenAiAssistantDialog" />
</MudTooltip>

@code {
    [Parameter] public ContentNodeInfo Node { get; set; } = null!;
    [Parameter] public EventCallback<string> OnSuggestedContentChanged { get; set; }
    
    private async Task OpenAiAssistantDialog()
    {
        var parameters = new DialogParameters
        {
            ["ContentNodeId"] = Node.Id,
            ["NodeContent"] = Node.Text,
            ["NodeDisplayName"] = GetSectionName(),
            ["OnSuggestedContentReceived"] = OnSuggestedContentChanged
        };

        var dialog = await DialogService.ShowAsync<ContentNodeAiAssistantDialog>("AI Content Assistant", parameters, new DialogOptions
        {
            MaxWidth = MaxWidth.ExtraLarge,
            FullWidth = true,
            CloseButton = true,
            BackdropClick = true,
            Position = DialogPosition.Center
        });

        await dialog.Result;
    }

    private string GetSectionName()
    {
        // Try to find a meaningful name from the node hierarchy
        if (Node is { Type: ContentNodeType.BodyText, ParentId: not null })
        {
            return "Content Section";
        }
        
        return Node.Text ?? "Content Section";
    }
}