@using Microsoft.Greenlight.Shared.Contracts.DTO.Document

@code {
    [Parameter] public ContentNodeSystemItemInfo? SystemItem { get; set; }
}

@if (SystemItem != null)
{
    <MudPaper Class="pa-3 mb-3" Outlined="true">
        <MudText Typo="Typo.h3">Reference Information:</MudText>
        <MudDivider Class="my-2" />
        <MudExpansionPanels>
        @if (SystemItem.ComputedUsedMainGenerationPrompt != null)
        {
            <MudExpansionPanel Text="Computed Used Main Generation Prompt" Color="Color.Info">
                <MudText Typo="Typo.body1">@SystemItem.ComputedUsedMainGenerationPrompt</MudText>
            </MudExpansionPanel>
        }
        @if (SystemItem.ComputedSectionPromptInstructions != null)
        {
            <MudExpansionPanel Text="Computed Section Prompt Instructions" Color="Color.Info">
                <MudText Typo="Typo.body1">@SystemItem.ComputedSectionPromptInstructions</MudText>
            </MudExpansionPanel>
        }
        </MudExpansionPanels>
        @if (SystemItem.SourceReferences.Count > 0)
        {
            <MudText Typo="Typo.h4"><strong>Source References:</strong></MudText>

            @if (SystemItem.SourceReferences.OfType<KernelMemoryDocumentSourceReferenceItemInfo>().Any())
            {
                <MudText Typo="Typo.h5">Document References (Citations)</MudText>
                <ul>
                    @foreach (var kernelMemoryItem in SystemItem.SourceReferences.OfType<KernelMemoryDocumentSourceReferenceItemInfo>())
                    {
                        <li>
                            @kernelMemoryItem.Description (@kernelMemoryItem.SourceReferenceType)
                            @foreach (var citation in kernelMemoryItem.Citations)
                            {
                                @* This needs to be a link to a dialog that shows the full partitions from the citation in question *@
                                <strong>Kernel Memory Citation:</strong>
                                @citation.SourceName
                                <br />
                            }
                        </li>
                    }
                </ul>
            }

            @if (SystemItem.SourceReferences.OfType<PluginSourceReferenceItemInfo>().Any())
            {
                <MudText Typo="Typo.h5">Plugin Execution References</MudText>
                <ul>
                    @foreach (var pluginItem in SystemItem.SourceReferences.OfType<PluginSourceReferenceItemInfo>())
                    {
                        <li>
                            @pluginItem.Description (@pluginItem.SourceReferenceType)
                            <p>
                                <strong>Plugin Identifier: </strong> @pluginItem.PluginIdentifier
                                <br />
                                @* These items should probably display in an expanding panel (the inputs and outputs)*@
                                <strong>Plugin inputs:</strong>
                                <RenderMultilineText Value="@pluginItem.SourceInputJson" />
                                <br />
                                <strong>Plugin output:</strong>
                                <RenderMultilineText Value="@pluginItem.SourceOutput" />
                            </p>
                        </li>
                    }
                </ul>
            }
        }
    </MudPaper>
}