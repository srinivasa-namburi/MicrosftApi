@page "/plugins"

@inject IPluginApiClient PluginApiClient
@inject ISnackbar Snackbar
@inject IDialogService DialogService

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
    <MudPaper Class="pa-4">
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="ShowUploadDialog">Upload Plugin</MudButton>
        <MudTable Items="_plugins" Hover="true" Striped="false">
            <HeaderContent>
                <MudTh>Plugin Name</MudTh>
                <MudTh>Latest Version</MudTh>
                <MudTh>Actions</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd>@context.Name</MudTd>
                <MudTd>@context.LatestVersion</MudTd>
                <MudTd>
                    <MudStack Row="true" Spacing="3">
                        <MudTooltip Delay="400" Text="Associate Plugin">
                            <MudIconButton OnClick="() => ShowAssociateDialog(context)" Size="@Size.Small" Icon="@Icons.Material.Filled.Link"></MudIconButton>
                        </MudTooltip>
                        <MudTooltip Delay="400" Text="Disassociate Plugin">
                            <MudIconButton OnClick="() => ShowDisassociateDialog(context)" Size="@Size.Small" Icon="@Icons.Material.Filled.LinkOff"></MudIconButton>
                        </MudTooltip>
                    </MudStack>
                </MudTd>
            </RowTemplate>
        </MudTable>
    </MudPaper>
</MudContainer>

@code {
    private List<DynamicPluginInfo> _plugins = new();

    protected override async Task OnInitializedAsync()
    {
        _plugins = await PluginApiClient.GetAllPluginsAsync();
    }

    private void ShowUploadDialog()
    {
        var parameters = new DialogParameters();
        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Small, FullWidth = true };
        DialogService.Show<UploadPluginDialog>("Upload Plugin", parameters, options);
    }

    private void ShowAssociateDialog(DynamicPluginInfo plugin)
    {
        var parameters = new DialogParameters { { "Plugin", plugin } };
        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Small, FullWidth = true };
        DialogService.Show<AssociatePluginDialog>("Associate Plugin", parameters, options);
    }

    private void ShowDisassociateDialog(DynamicPluginInfo plugin)
    {
        var parameters = new DialogParameters { { "Plugin", plugin } };
        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Small, FullWidth = true };
        DialogService.Show<DisassociatePluginDialog>("Disassociate Plugin", parameters, options);
    }
}
