# GitHub Environment Configuration Sample
# Copy this file and customize for your environment:
# cp build/environment-variables-github-sample.yml build/environment-variables-github-dev.yml

environment:
  name: dev  # Environment name - must match GitHub environment name

# Environment-specific variables (visible in GitHub Actions logs)
variables:
  AZURE_SUBSCRIPTION_ID: "00000000-0000-0000-0000-000000000000"  # Replace with your Azure subscription ID
  AZURE_RESOURCE_GROUP: "rg-greenlight-dev"                      # Resource group for deployment
  AZURE_LOCATION: "eastus"                                       # Azure region (eastus, westus2, etc.)
  AKS_NAMESPACE: "greenlight-dev"                                # Kubernetes namespace for deployment
  HELM_RELEASE: "greenlight-dev"                                 # Helm release name (should match environment)

  # KUBERNETES_RESOURCES_CONFIG: Kubernetes resource requests/limits and autoscaling configuration
  # IMPORTANT: This variable MUST be added manually in GitHub Environment variables
  # GitHub Actions cannot properly handle multiline JSON in YAML variable sections
  #
  # Recommended production configuration (adapt based on your workload):
  # - API Main: 3-8 replicas, 500m CPU / 1GB RAM per pod
  # - Silo (Orleans): 3-10 replicas, 2-4 CPU / 2-4GB RAM per pod (higher for background processing)
  # - Web DocGen: 1-3 replicas, 250m CPU / 256-512MB RAM per pod
  # - MCP Server: 1 replica only (does not scale horizontally), 250m CPU / 256-512MB RAM per pod
  # - DB Setup Manager: Job (no autoscaling, single instance), 250m CPU / 256-512MB RAM
  #
  # To add this variable in GitHub:
  # 1. Go to Settings > Environments > <your-environment-name> > Environment variables
  # 2. Click "Add variable"
  # 3. Name: KUBERNETES_RESOURCES_CONFIG
  # 4. Value: Copy the SINGLE-LINE JSON below (as-is, no modifications):
  #
  # {"api-main":{"requests":{"cpu":"500m","memory":"512Mi"},"limits":{"cpu":"1","memory":"1Gi"},"replicas":{"min":1,"max":1}},"web-docgen":{"requests":{"cpu":"250m","memory":"256Mi"},"limits":{"cpu":"500m","memory":"512Mi"},"replicas":{"min":1,"max":3}},"silo":{"requests":{"cpu":"2","memory":"2Gi"},"limits":{"cpu":"4","memory":"4Gi"},"replicas":{"min":3,"max":10}},"mcpserver-core":{"requests":{"cpu":"100m","memory":"128Mi"},"limits":{"cpu":"500m","memory":"512Mi"},"replicas":{"min":1,"max":5}},"mcpserver-flow":{"requests":{"cpu":"250m","memory":"256Mi"},"limits":{"cpu":"500m","memory":"512Mi"},"replicas":{"min":1,"max":1}},"db-setupmanager":{"requests":{"cpu":"250m","memory":"256Mi"},"limits":{"cpu":"500m","memory":"512Mi"}}}
  #
  # For easier editing, here's the formatted version (for reference only - DO NOT copy with newlines):
  # {
  #   "api-main": {
  #     "requests": {"cpu": "500m", "memory": "512Mi"},
  #     "limits": {"cpu": "1", "memory": "1Gi"},
  #     "replicas": {"min": 1, "max": 1}
  #   },
  #   "web-docgen": {
  #     "requests": {"cpu": "250m", "memory": "256Mi"},
  #     "limits": {"cpu": "500m", "memory": "512Mi"},
  #     "replicas": {"min": 1, "max": 3}
  #   },
  #   "silo": {
  #     "requests": {"cpu": "2", "memory": "2Gi"},
  #     "limits": {"cpu": "4", "memory": "4Gi"},
  #     "replicas": {"min": 3, "max": 10}
  #   },
  #   "mcpserver-core": {
  #     "requests":{"cpu":"100m","memory":"128Mi"},
  #     "limits":{"cpu":"500m","memory":"512Mi"},
  #     "replicas":{"min":1,"max":5}
  #   },
  # "mcpserver-flow": {
  #     "requests": {"cpu": "250m", "memory": "256Mi"},
  #     "limits": {"cpu": "500m", "memory": "512Mi"},
  #     "replicas": {"min": 1, "max": 1}
  #   },
  #   "db-setupmanager": {
  #     "requests": {"cpu": "250m", "memory": "256Mi"},
  #     "limits": {"cpu": "500m", "memory": "512Mi"}
  #   }
  # }

# REQUIRED Environment secrets (encrypted in GitHub)
secrets:
  # AZURE_CREDENTIALS: JSON from 'az ad sp create-for-rbac' command (REQUIRED for deployment)
  # Must be valid JSON on a single line, with escaped quotes:
  AZURE_CREDENTIALS: "{ \"clientId\": \"<YOUR-SP-CLIENT-ID>\", \"clientSecret\": \"<SECRET>\", \"subscriptionId\": \"<YOUR-SUBSCRIPTION-ID>\", \"tenantId\": \"<YOUR-TENANT-ID>\" }"

  # PVICO_ENTRA_CREDENTIALS: JSON from '.\build\scripts\sp-create.ps1' script (REQUIRED for authentication)
  # Must be valid JSON on a single line, with escaped quotes:
  PVICO_ENTRA_CREDENTIALS: "{\"TenantId\": \"<YOUR-TENANT-ID>\", \"ClientId\": \"<YOUR-APP-CLIENT-ID>\", \"Scopes\": \"https://graph.microsoft.com/.default\", \"ClientSecret\": \"<SECRET>\"}"

# OPTIONAL Environment secrets (can be configured post-deployment via Configuration UI)
  # PVICO_AZUREMAPS_KEY: Azure Maps API key (optional - can be configured post-deployment)
  # Note: Can be left empty initially and configured later via Configuration UI at /admin/configuration?section=secrets
  # The application will start without Azure Maps features until configured
  # PVICO_AZUREMAPS_KEY: "<SECRET>"

  # PVICO_OPENAI_CONNECTIONSTRING: Azure OpenAI connection string (optional - can be configured post-deployment)
  # Format: "Endpoint=https://your-resource.openai.azure.com/;Key=<SECRET>"
  # Note: Can be left empty initially and configured later via Configuration UI at /admin/configuration?section=secrets
  # The application will start without OpenAI features until configured
  # PVICO_OPENAI_CONNECTIONSTRING: "Endpoint=https://my-openai.openai.azure.com/;Key=<SECRET>"

# Additional optional variables can be added here:
# HOSTNAME_OVERRIDE: "{\"WebApplicationUrl\": \"https://myapp.example.com\", \"ApiBaseUrl\": \"https://api.myapp.example.com\"}"
# DEPLOYMENT_MODEL: "public"  # public, private, or hybrid
# MEMORY_BACKEND: "aisearch"  # aisearch (default) or postgres
