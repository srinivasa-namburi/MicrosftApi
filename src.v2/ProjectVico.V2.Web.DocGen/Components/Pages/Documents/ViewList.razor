@attribute [Authorize]
@page "/docs"

@using ProjectVico.V2.Web.Shared.ServiceClients
@using ProjectVico.V2.Shared.Contracts.DTO

@inject IDocumentGenerationApiClient DocumentGenerationApiClient
@inject NavigationManager Navigation

<PageTitle>Generated Documents List</PageTitle>

<MudText Typo="Typo.h4" GutterBottom="true">Generated Documents List</MudText>

@if (documents is null)
{
    <MudPaper Class="pa-4">
        <MudSkeleton />
    </MudPaper>
}
else if (documents.Count == 0)
{
    <MudPaper Class="pa-4">
        <MudText>No documents found.</MudText>
    </MudPaper>
}
else
{
    <MudDataGrid Items="@documents.OrderByDescending(x => x.GeneratedDate)" Filterable="false" SortMode="@SortMode.None" Groupable="false">
        <Columns>
            <PropertyColumn Property="x => x.GeneratedDate.ToShortDateString()" Title="Date Generated" />
            <PropertyColumn Property="x => x.Title" />
            <TemplateColumn CellClass="d-flex justify-end">
                <CellTemplate>
                    <MudStack Row="true">
                        <MudButton OnClick="@(() => ViewDocument(context.Item))" Size="@Size.Small" Variant="@Variant.Filled" Color="@Color.Primary">View</MudButton>
                    </MudStack>
                </CellTemplate>
            </TemplateColumn>
        </Columns>
    </MudDataGrid>
}

@* <MudPaper Class="pa-4">
    @if (documents is null)
    {
        <MudProgressCircular Indeterminate="true" />
    }
    else if (documents.Count == 0)
    {
        <MudText>No documents found.</MudText>
    }
    else
    {
        <MudList>
            @foreach (var document in documents.OrderBy(x=>x.GeneratedDate))
            {
                <MudListItem OnClick="@(() => ViewDocument(document))" Button="true">
                    <MudText>@document.Title</MudText>
                    <MudText Typo="Typo.subtitle2">@document.GeneratedDate.ToString("yyyy-MM-dd")</MudText>
                </MudListItem>
            }
        </MudList>
    }
</MudPaper> *@

@code {
    private List<GeneratedDocumentListItem> documents;

    protected override async Task OnInitializedAsync()
    {
        documents = await DocumentGenerationApiClient.GetGeneratedDocumentsAsync();
    }

    private void ViewDocument(GeneratedDocumentListItem document)
    {
        Navigation.NavigateTo($"/docs/{document.Id}");
    }

}